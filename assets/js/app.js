(()=>{const e=document.getElementById("preisrechnerModal");if(!e)return;const t=new bootstrap.Modal(e);document.querySelectorAll("#btnPreisrechnerHero,#btnPreisrechnerHero2,[data-price-wizard]").forEach(e=>{e?.addEventListener("click",(e=>{e.preventDefault(),t.show()}))});const a=Array.from(e.querySelectorAll(".wizard-step")),n=Array.from(e.querySelectorAll(".wizard-steps li"));let r=0;const s={address:{},typ:"wohnung",fields:{}},l=e.querySelector("#liveSummary"),o=e=>{r=Math.max(0,Math.min(a.length-1,e)),a.forEach(((e,t)=>e.classList.toggle("d-none",t!==r))),n.forEach(((e,t)=>e.classList.toggle("active",t===r))),e.querySelector("#btnBack").disabled=0===r,e.querySelector("#btnNext").textContent=r===a.length-1?"Schließen":r===a.length-2?"Absenden":"Weiter"},i=()=>{const e=[],t=[s.address.strasse,s.address.hausnr,s.address.plz,s.address.ort].filter(Boolean).join(" ");e.push(["Adresse",t||"–"]),e.push(["Objektart",s.typ||"–"]),s.fields.baujahr&&e.push(["Baujahr",s.fields.baujahr]),s.fields.flaeche&&e.push(["Fläche",s.fields.flaeche+" m²"]),s.fields.grundstueck&&e.push(["Grundstück",s.fields.grundstueck+" m²"]),s.fields.energie&&e.push(["Energie",s.fields.energie]),l.innerHTML=e.map((([e,t])=>`<dt class="col-6">${e}</dt><dd class="col-6 text-end">${t}</dd>`)).join("")},c=e.querySelector("#plz"),d=e.querySelector("#ortSelect"),u=e.querySelector("#strasseSelect"),m=e.querySelector("#hausnr"),h=e.querySelector("#reloadOrte"),p=e.querySelector("#btnManuelleStrasse");async function g(){const e=(c.value||"").trim();if(5!==e.length)return void(d.innerHTML='<option value="">Bitte PLZ eingeben</option>');d.innerHTML='<option value="">Lade Orte…</option>';try{const t=await fetch(`https://openplzapi.org/de/${e}`),a=await t.json();Array.isArray(a)&&a.length?d.innerHTML='<option value="">Ort wählen…</option>'+a.map((e=>`<option>${(e.ort||e.place||"").toString()}</option>`)).join(""):d.innerHTML='<option value="">Keine Orte gefunden</option>'}catch(e){d.innerHTML='<option value="">Fehler – Ort manuell eingeben</option>'}}async function v(){if(u.innerHTML='<option value="">Lade Straßen…</option>',!c.value||!d.value)return void(u.innerHTML='<option value="">Bitte Ort wählen</option>');try{const e=await fetch(`https://openplzapi.org/de/${c.value}/${encodeURIComponent(d.value)}/strassen`);if(e.ok){const t=await e.json();if(Array.isArray(t)&&t.length){u.innerHTML='<option value="">Straße wählen…</option>'+t.slice(0,300).map((e=>`<option>${(e.strasse||e.street||e).toString()}</option>`)).join("");return}}u.innerHTML='<option value="">Keine API-Daten – bitte manuell eingeben</option>'}catch(e){u.innerHTML='<option value="">Straßen konnten nicht geladen werden</option>'}}c.addEventListener("input",(()=>{5===c.value.length&&g()})),h.addEventListener("click",g),d.addEventListener("change",v),p.addEventListener("click",(()=>{const t=document.createElement("input");t.className="form-control",t.placeholder="Straße eingeben",t.id="strasseInput",u.replaceWith(t)})),e.querySelectorAll('input[name="typ"]').forEach((e=>e.addEventListener("change",(()=>{s.typ=e.value,y(),i()}))));function f(e,t,a,n="number",r=""){return`<div class="col-md-${e}"><label class="form-label">${t}</label><input class="form-control" id="${a}" type="${n}" placeholder="${r}"></div>`}function b(e,t,a,n){const r=n.map((e=>`<option>${e}</option>`)).join("");return`<div class="col-md-${e}"><label class="form-label">${t}</label><select class="form-select" id="${a}"><option value="">Bitte wählen</option>${r}</select></div>`}function y(){const t=e.querySelector("#fieldsContainer");let a="";"wohnung"===s.typ?(a+=f(6,"Baujahr","baujahr","number","z. B. 1995"),a+=f(6,"Wohnfläche (m²)","flaeche","number","z. B. 85"),a+=f(6,"Etage","etage","number","z. B. 3"),a+=f(6,"Anzahl Zimmer","zimmer","number","z. B. 3"),a+=f(6,"Balkon / Terrasse (m²)","balkon","number","z. B. 6"),a+=f(6,"Garten (m²)","garten","number","z. B. 10"),a+=b(6,"Energie-Label","energie",["A+","A","B","C","D","E","F","G"]),a+=b(6,"Art der Wärmeerzeugung","heizung",["Fernwärme","Gas","Öl","Wärmepumpe","Strom/Elektro","Sonstiges"])):"haus"===s.typ?(a+=b(6,"Subtype","subtype",["Einfamilienhaus","Doppelhaushälfte","Reihenhaus","Bungalow","Villa"]),a+=b(6,"Transaktionstyp","tx",["Verkauf","Vermietung"]),a+=f(6,"Baujahr","baujahr","number","z. B. 1990"),a+=f(6,"Wohnfläche (m²)","flaeche","number","z. B. 140"),a+=f(6,"Grundstücksfläche (m²)","grundstueck","number","z. B. 500"),a+=b(6,"Erbpacht","erbpacht",["Nein","Ja"]),a+=b(6,"Energie-Label","energie",["A+","A","B","C","D","E","F","G"]),a+=f(6,"Anzahl Etagen","etagen","number"),a+=f(6,"Anzahl Zimmer","zimmer","number"),a+=f(6,"Anzahl Badezimmer","bads","number"),a+=f(6,"Balkon / Terrasse (m²)","balkon","number"),a+=f(6,"Garagenplätze","garage","number"),a+=f(6,"Außenparkplätze","parken","number"),a+=b(6,"Art der Wärmeerzeugung","heizung",["Fernwärme","Gas","Öl","Wärmepumpe","Strom/Elektro","Sonstiges"])):(a+="<h6 class='mt-2'>Mehrfamilienhaus-Spezifikation</h6>",a+=f(6,"Baujahr","baujahr","number","z. B. 1965"),a+=f(6,"Modernisierungsjahr","modj","number"),a+=f(6,"Anzahl Wohneinheiten","einheiten","number"),a+=f(6,"Gesamtwohnfläche (m²)","flaeche","number"),a+=f(6,"Grundstücksfläche (m²)","grundstueck","number"),a+=b(6,"Energie-Label","energie",["A+","A","B","C","D","E","F","G"]),a+=f(6,"Jährliche Nettomieteinnahmen (EUR)","miete","number")),t.innerHTML=a,t.querySelectorAll("input,select").forEach((e=>{e.addEventListener("input",(()=>{s.fields[e.id]=e.value,i()}))}))}y();const q=()=>{const t=e.querySelector("#strasseInput");s.address={plz:(c.value||"").trim(),ort:(d.value||"").trim(),strasse:t?t.value.trim():(u&&u.value||"").trim(),hausnr:(m.value||"").trim()}};e.querySelector("#btnBack").addEventListener("click",(e=>{e.preventDefault(),o(r-1)})),e.querySelector("#btnNext").addEventListener("click",(t=>{if(t.preventDefault(),0===r){if(q(),!s.address.plz||!s.address.ort||!s.address.hausnr)return void alert("Bitte PLZ, Ort und Hausnummer angeben.")}3===r&&(e.querySelector("#summaryPreview").innerHTML=l.innerHTML),o(r+1)})),e.addEventListener("shown.bs.modal",(()=>o(0))),i()})();